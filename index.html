<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Restaurant Assistant</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fafafa;
    text-align: center;
    padding: 20px;
  }
  h2 {
    margin-bottom: 10px;
  }
  textarea {
    width: 90%;
    height: 100px;
    font-size: 16px;
    margin-top: 10px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background-color: #0078d7;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    margin: 8px;
    cursor: pointer;
  }
  button:hover {
    background-color: #005fa3;
  }
</style>
</head>
<body>
<h2>üçΩÔ∏è AI Restaurant Assistant</h2>
<p>Speak or type in any language</p>

<button id="micBtn">üé§ Speak</button>
<textarea id="userInput" placeholder="Ask or say something..."></textarea>
<button id="askBtn">Ask</button>

<textarea id="response" placeholder="Assistant reply..." readonly></textarea>

<script>
const micBtn = document.getElementById("micBtn");
const askBtn = document.getElementById("askBtn");
const userInput = document.getElementById("userInput");
const responseBox = document.getElementById("response");

// üé§ Ses tanƒ±ma
let recognition;
if ("webkitSpeechRecognition" in window) {
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "auto";
  recognition.onresult = (event) => {
    userInput.value = event.results[0][0].transcript;
  };
  recognition.onerror = () => alert("Voice recognition error");
} else {
  micBtn.disabled = true;
  micBtn.textContent = "üé§ Not supported";
}

micBtn.addEventListener("click", () => {
  if (recognition) recognition.start();
});

// üß† GPT (Cloudflare Worker)
async function askGPTWorker(prompt, menuData) {
  const fullPrompt = `
You are a multilingual restaurant assistant.
You understand any language and respond in the same language as the customer.
If the customer asks for a category (like drinks, vegan, spicy, etc.), use that filter on the menu.
Menu data:
${JSON.stringify(menuData, null, 2)}
Customer says: "${prompt}"
Reply kindly, and give 1‚Äì2 suitable suggestions from the menu.
`;

  const res = await fetch("https://mandarinopenai.furkan285saglam.workers.dev/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      messages: [
        { role: "system", content: "You are a helpful and friendly restaurant assistant." },
        { role: "user", content: fullPrompt }
      ]
    })
  });

  const data = await res.json();
  return data.choices?.[0]?.message?.content?.trim() || "No response.";
}

// üßæ GPT √ßaƒürƒ±sƒ±
askBtn.addEventListener("click", async () => {
  const text = userInput.value.trim();
  if (!text) return;
  responseBox.value = "Thinking...";

  try {
    const menuRes = await fetch("menu.json");
    const menuData = await menuRes.json();
    const reply = await askGPTWorker(text, menuData);
    responseBox.value = reply;
  } catch (err) {
    responseBox.value = "Error: " + err.message;
  }
});
</script>
</body>
</html>
