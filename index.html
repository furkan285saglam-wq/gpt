<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Restaurant Assistant</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fafafa;
    text-align: center;
    padding: 20px;
  }
  textarea {
    width: 90%;
    height: 100px;
    font-size: 16px;
    margin-top: 10px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background-color: #0078d7;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    margin: 8px;
    cursor: pointer;
  }
  button:hover {
    background-color: #005fa3;
  }
</style>
</head>
<body>
<h2>ğŸ½ï¸ Voice-Enabled Restaurant Assistant</h2>
<p>Speak or type in any language</p>

<button id="micBtn">ğŸ¤ Speak</button>
<textarea id="userInput" placeholder="Ask or say something..."></textarea>
<button id="askBtn">Ask</button>
<button id="speakOutBtn">ğŸ”Š Read Reply</button>

<textarea id="response" placeholder="Assistant reply..." readonly></textarea>

<script>
const micBtn = document.getElementById("micBtn");
const askBtn = document.getElementById("askBtn");
const speakOutBtn = document.getElementById("speakOutBtn");
const userInput = document.getElementById("userInput");
const responseBox = document.getElementById("response");

// ğŸ”‘ kendi OpenAI API anahtarÄ±nÄ± buraya koy
const OPENAI_API_KEY = "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";

// ğŸ¤ Ses tanÄ±ma ayarlarÄ±
let recognition;
if ("webkitSpeechRecognition" in window) {
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = "auto"; // TarayÄ±cÄ± genelde sistem dilini alÄ±r
  recognition.onresult = (event) => {
    userInput.value = event.results[0][0].transcript;
  };
  recognition.onerror = () => alert("Voice recognition error");
} else {
  micBtn.disabled = true;
  micBtn.textContent = "ğŸ¤ Not supported";
}

micBtn.addEventListener("click", () => {
  if (recognition) recognition.start();
});

// ğŸ”Š CevabÄ± sesli okuma
speakOutBtn.addEventListener("click", () => {
  const msg = new SpeechSynthesisUtterance(responseBox.value);
  msg.lang = "auto";
  window.speechSynthesis.speak(msg);
});

// ğŸ§  GPT fonksiyonu
async function askGPT(prompt, menuData) {
  const fullPrompt = `
You are a multilingual restaurant assistant.
You understand any language and respond in the same language as the customer.
If the customer asks for a category (like drinks, vegan, spicy, etc.), use that filter on the menu.
Menu data:
${JSON.stringify(menuData)}
Customer says: "${prompt}"
Reply kindly, and give 1-2 suitable suggestions from the menu.
`;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + OPENAI_API_KEY,
    },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      messages: [{ role: "user", content: fullPrompt }],
    }),
  });
  const data = await res.json();
  return data.choices[0].message.content.trim();
}

// ğŸ§¾ GPT Ã§aÄŸrÄ±sÄ±
askBtn.addEventListener("click", async () => {
  const text = userInput.value.trim();
  if (!text) return;
  responseBox.value = "Thinking...";

  try {
    const menuRes = await fetch("menu.json");
    const menuData = await menuRes.json();
    const reply = await askGPT(text, menuData);
    responseBox.value = reply;
  } catch (err) {
    responseBox.value = "Error: " + err.message;
  }
});
</script>
</body>
</html>

